worker_processes  auto;
events { worker_connections 1024; }

http {
    include       mime.types;
    default_type  application/octet-stream;

    lua_shared_dict auto_ssl 64m;
    lua_shared_dict domain_backends 10m;

    resolver 8.8.8.8;

    init_by_lua_block {
        auto_ssl = (require "resty.auto-ssl").new()
        auto_ssl:set("dir", "/etc/nginx/ssl")
        auto_ssl:set("allow_domain", function(domain)
            return true  -- semua domain diizinkan autoSSL
        end)
        auto_ssl:init()
    }

    init_worker_by_lua_block {
        auto_ssl:init_worker()
    }

    include profiles/*.conf;
}
